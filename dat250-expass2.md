# DAT250: Assignment 2
By 587900 (Kjetil Berg)

### Description
The instructions of https://github.com/selabhvl/dat250public/blob/master/expassignments/expass2.md was followed to create a test application for database interaction. Everything went according to the instructions besides what is mention under the 'Trials and tribulations' section (problems and noteworthy moments).

### Trials and tribulations
1. During the building of the tutorial app, java 11 was not enough (the course stated we should use java 11). I had to install at least java 17. I used Intellij to install java 20 automatically.
2. The instructions said 'all tests should pass', but they did not. I read that part wrong. It said 'after my implementation is finished'. I find it kind of funny that the official repository has a single workflow icon that says 'tests are failing' :)
3. I did not immediately realize Lombok was being used, so I manually created getters and setters for the classes in part 2. I eventually replaced these with Lombok
4. During part 2, JPA created two join tables for every many-to-many relation by default (for example Address_Customer AND Customer_Address). I tried many things, but had to resort to @JoinTable to get it to behave. There were still problems. I had to also define @joinColumns and @inverseJoinColumns in the @JoinTable annotation
5. Running tests caused a weird bug where entries would be duplicated when JPA commits them to the database. My classmates adviced I use 'Set' instead of 'Collection', but the problems still persisted. I eventually found out that @JoinTable was the culprit. After some more help, I managed to use the 'mappedBy' parameter correctly inside the @ManyToMany and @OneToMany annotations (Note: I already tried this, but it didn't work before I started using @JoinTable. Then now it suddenly works? I am not convinced JPA is a stable technology). After using the 'mappedBy' parameter, the tests ran correctly.

### Questions during the assignment
1. From tutorial: 'Which database is used and where does it store its files': The database being used is Hibernate H2 (as per persistence.xml hibernate.connection.url). The file seems to be 'DB.mv.db' in the root directory (see question 3).
2. From tutorial: 'Where do the getters/setters come from?': Lombok has annotations named @Getter and @Setter, that generate getters and setters for every field (required 'annotation processing' to be enabled). In part 2 there were some getters/setters with unique names that had to be created manually.
3. From part 2: 'Where is the database?': It seems the database is a local file. The persistence.xml says to 'create' the database upon every run, so it gets cleared every time. There is a file named 'DB.mv.db'. That is probably it.
4. From part 2: 'Provide the SQL use to create the table Customer': I set 'hibernate-show_sql' to 'true' in persistence.xml, and this appeared in the log:
```
Hibernate:
    create table Customer (
        id bigint generated by default as identity,
        name varchar(255),
        primary key (id)
    )
```
5. From part 2: 'Inspect the database and attach a screenshot. Do the created tables correspond to your initial thoughts?': Yes they correspond. There was no easy way of inspecting the database. Some classmates tried plugins or method of inspecting the 'DB.mv.db' file, but none I met succeeded. I ended up using 'show_sql' and copying the sql code into an online editor named [sqldb](https://sqldbd.com/app). I had to clean out the 'Hibernate:' statements and remove tables from the tutorial, but I got this:
![Database structure](https://raw.githubusercontent.com/587900/dat250-jpa-tutorial/master/db-sql.png)
The sql I uploaded to sqldb can be found in the '[db.sql](https://raw.githubusercontent.com/587900/dat250-jpa-tutorial/master/db.sql)' file.